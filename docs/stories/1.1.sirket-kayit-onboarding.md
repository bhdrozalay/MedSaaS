# Story 1.1: Şirket Kayıt ve Onboarding Süreci

**Story ID:** 1.1
**Epic:** Platform Temel Altyapısı
**Status:** Draft
**Story Points:** 8
**Sprint:** Sprint 1

## User Story
**As a** şirket sahibi/yöneticisi  
**I want to** şirketimi MedSaaS platformuna kaydedebilmek ve 15 günlük demo sürecini başlatabilmek  
**So that** platformun özelliklerini test edebilirim ve iş süreçlerime uygunluğunu değerlendirebilirim

## Acceptance Criteria

### AC-01: Şirket Kayıt Formu
- [ ] Kullanıcı web sitesinde "Ücretsiz Dene" butonuna tıklayabilir
- [ ] Kayıt formu şu alanları içerir:
  - Şirket Adı (zorunlu)
  - Vergi No/TC No (zorunlu)
  - Sektör seçimi (dropdown)
  - Şirket Telefonu (zorunlu)
  - Şirket E-postası (zorunlu)
  - Yetkilisi Adı Soyadı (zorunlu)
  - Yetkili E-postası (zorunlu)
  - Yetkili Telefonu (zorunlu)
  - Şirket Adresi (zorunlu)
- [ ] Form validasyonu gerçek zamanlı çalışır
- [ ] E-posta formatı kontrolü yapılır
- [ ] Telefon numarası formatı kontrol edilir

### AC-02: Multi-Tenant Altyapı
- [ ] Her şirket için benzersiz tenant oluşturulur
- [ ] Tenant ID otomatik generate edilir
- [ ] Database seviyesinde tenant izolasyonu sağlanır
- [ ] Tenant'a özel subdomain oluşturulur (opsiyonel)

### AC-03: Demo Süreç Başlatma
- [ ] Kayıt tamamlandığında sistem otomatik 15 günlük demo hesabı oluşturur
- [ ] Demo hesabı "pending_approval" statusünde başlar
- [ ] Demo süre sayacı henüz başlamaz
- [ ] Tüm modüller demo modunda erişilebilir olur

### AC-04: Admin Onay Sistemi
- [ ] Sistem admin'e yeni demo talebi bildirimi gönderir
- [ ] Admin panel'de bekleyen demo talepleri listelenir
- [ ] Admin demo talebini "onaylayabilir" veya "reddedebilir"
- [ ] Onay sonrası hesap "active_demo" statusüne geçer
- [ ] 15 günlük demo sayacı başlar
- [ ] Red durumunda hesap "rejected" statusüne geçer

### AC-05: E-posta Bildirimleri
- [ ] Kayıt sonrası "Başvurunuz alındı" e-postası gönderilir
- [ ] Onay sonrası "Demo hesabınız aktif" e-postası gönderilir
- [ ] E-postada giriş bilgileri ve ilk adımlar yer alır
- [ ] Demo süresine 3 gün kala uyarı e-postası gönderilir
- [ ] Demo süresi dolmadan 1 gün önce son uyarı gönderilir

### AC-06: İlk Kullanıcı Oluşturma
- [ ] Şirket kaydıyla birlikte yetkili kişi için kullanıcı oluşturulur
- [ ] Bu kullanıcı otomatik "tenant_admin" rolüne sahip olur
- [ ] Güvenli şifre oluşturma linki e-posta ile gönderilir
- [ ] İlk giriş sonrası şifre değiştirme zorunlu tutulur

### AC-07: Demo Süresi Yönetimi
- [ ] Demo süresi 15 gün olarak ayarlanır
- [ ] Süre geriye doğru sayılır ve dashboard'da görünür
- [ ] Demo süresi dolunca hesap "expired_demo" statusüne geçer
- [ ] Expired hesaplar sadece abonelik sayfasına yönlendirilir

### AC-08: Modül Erişim Kontrolü
- [ ] Demo süresince tüm modüllere erişim sağlanır
- [ ] Her modülde "Demo Modu" badge'i görünür
- [ ] Demo veriler ile çalışır (gerçek iş verisi değil)
- [ ] Modül başına kullanım limitleri uygulanır

### AC-09: Güvenlik Kontrolleri
- [ ] HTTPS zorunlu (HTTP redirect)
- [ ] Rate limiting uygulanır (dakikada 10 kayıt)
- [ ] CAPTCHA entegrasyonu (bot koruması)
- [ ] SQL injection ve XSS koruması
- [ ] Güvenlik audit log tutulur

### AC-10: Abonelik Geçiş Hazırlığı
- [ ] Demo süre dolmadan "Abonelik Satın Al" butonu görünür
- [ ] Abonelik sayfası fiyatlandırma bilgilerini gösterir
- [ ] Demo veriler abonelik sonrası korunabilir
- [ ] Migrasyon süreci tanımlanır

## Technical Requirements

### Database Schema
```sql
-- Tenants table
CREATE TABLE tenants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    company_name VARCHAR(255) NOT NULL,
    tax_number VARCHAR(50) NOT NULL UNIQUE,
    sector VARCHAR(100),
    status VARCHAR(50) DEFAULT 'pending_approval',
    demo_start_date TIMESTAMP NULL,
    demo_end_date TIMESTAMP NULL,
    subdomain VARCHAR(100) UNIQUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Companies table (extended info)
CREATE TABLE companies (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(255) NOT NULL,
    address TEXT NOT NULL,
    authorized_person_name VARCHAR(255) NOT NULL,
    authorized_person_email VARCHAR(255) NOT NULL,
    authorized_person_phone VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### API Endpoints
- `POST /api/auth/register` - Şirket kaydı
- `GET /api/tenant/status` - Demo durum kontrolü
- `POST /api/admin/approve-demo` - Admin demo onayı
- `GET /api/tenant/demo-info` - Demo süre bilgisi

### Frontend Components
- `CompanyRegistrationForm.tsx`
- `DemoStatusBadge.tsx`
- `SubscriptionPrompt.tsx`

### Mobile Considerations
- Responsive kayıt formu
- Mobil dostu validasyon mesajları
- Touch-friendly form elementleri

## Definition of Done
- [ ] Tüm AC'ler test edildi ve geçti
- [ ] Security audit tamamlandı
- [ ] Performance testleri yapıldı
- [ ] Mobile responsiveness kontrol edildi
- [ ] E2E testler yazıldı ve geçti
- [ ] Documentation güncellendi
- [ ] Code review tamamlandı
- [ ] Staging environment'ta test edildi

## Dependencies
- NextAuth.js kurulumu
- PostgreSQL + Prisma schema
- E-posta servisi (SendGrid/AWS SES)
- Redis cache (demo süre yönetimi)

## Risk & Mitigation
- **Risk:** Spam kayıtlar
- **Mitigation:** CAPTCHA + rate limiting + admin onay

- **Risk:** Demo süre takibi hataları
- **Mitigation:** Redis + cron job + audit logging

## Notes
Bu story platform temelinin en kritik parçasıdır. Tüm diğer özellikler bu altyapıya dayanacaktır. Multi-tenant mimari ve güvenlik en yüksek öncelikle implement edilmelidir.